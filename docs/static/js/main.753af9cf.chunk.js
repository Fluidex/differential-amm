(this["webpackJsonpdifferential-amm"]=this["webpackJsonpdifferential-amm"]||[]).push([[0],{144:function(e,t,a){},145:function(e,t,a){},227:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(27),c=a.n(i),l=(a(144),a(105)),s=a.n(l),o=a(120),u=a(40),h=a(25),j=a(24),b=(a(145),a(232)),d=a(233),O=a(78),f=a(234),g=a(79),p=a(231),v=a(58),y=a(121),x=a(122);function m(e,t,a){var n=t*t-4*e*a;return[(-t+Math.sqrt(n))/(2*e),(-t-Math.sqrt(n))/(2*e)]}var k=function(){function e(){Object(y.a)(this,e)}return Object(x.a)(e,[{key:"totalBase",get:function(){return this.realBase+this.virtualBase}},{key:"totalQuote",get:function(){return this.realQuote+this.virtualQuote}},{key:"price",get:function(){return this.totalQuote/this.totalBase}},{key:"depth",get:function(){return Math.pow(this.totalBase,2)/(2*this.totalQuote)}},{key:"lowPrice",get:function(){return Math.pow(this.virtualQuote,2)/this.k}},{key:"highPrice",get:function(){return this.k/Math.pow(this.virtualBase,2)}},{key:"getBaseDiffForQuoteDiff",value:function(e){return this.k/(this.totalQuote+e)-this.totalBase}},{key:"getQuoteDiffForBaseDiff",value:function(e){return this.k/(this.totalBase+e)-this.totalQuote}},{key:"getReserveAtPrice",value:function(e){var t=Math.sqrt(this.k/e),a=Math.sqrt(this.k*e);return{totalBase:t,totalQuote:a,realBase:t-this.virtualBase,realQuote:a-this.virtualQuote}}},{key:"updateQuote",value:function(e){this.realQuote+=e,this.realBase=this.k/(this.realQuote+this.virtualQuote)-this.virtualBase}},{key:"updateBase",value:function(e){this.realBase+=e,this.realQuote=this.k/(this.realBase+this.virtualBase)-this.virtualQuote}},{key:"getRange",value:function(){return[this.lowPrice,this.highPrice]}},{key:"sellBase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=-this.getQuoteDiffForBaseDiff(e);return console.log("avg price",a/e),t||this.updateBase(e),a}},{key:"buyBase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.getQuoteDiffForBaseDiff(-e);return console.log("avg price",a/e),t||this.updateBase(-e),a}},{key:"sellForQuote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.getBaseDiffForQuoteDiff(-e);return console.log("avg price",e/a),t||this.updateQuote(-e),a}},{key:"buyWithQuote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=-this.getBaseDiffForQuoteDiff(e);return console.log("avg price",e/a),t||this.updateQuote(e),a}},{key:"toOrders",value:function(e,t){for(var a=[],n=1;n<=t&&!(this.price+n*e>this.highPrice);n++){var r=this.getReserveAtPrice(this.price+(n-1)*e),i=r.realBase,c=r.realQuote,l=this.getReserveAtPrice(this.price+n*e),s=l.realBase,o=(l.realQuote-c)/(i-s),u=i-s;a.push({price:o,amount:u})}for(var h=[],j=1;j<=t&&!(this.price-j*e<this.lowPrice);j++){var b=this.getReserveAtPrice(this.price-(j-1)*e),d=b.realBase,O=b.realQuote,f=this.getReserveAtPrice(this.price-j*e),g=f.realBase,p=(O-f.realQuote)/(g-d),v=g-d;h.push({price:p,amount:v})}return{buy:h,sell:a}}}],[{key:"createFromDepthAndReserve",value:function(t,a,n,r){var i=2*a*t,c=2*Math.pow(a,2)*t,l=i*c,s=i-n,o=c-r,u=new e;return u.realBase=n,u.realQuote=r,u.virtualBase=s,u.virtualQuote=o,u.k=l,u}},{key:"createFromDepthAndRange",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=2*t*e,i=2*Math.pow(t,2)*e,c=r*i,l=Math.sqrt(c/n),s=Math.sqrt(c*a),o=r-l,u=i-s;return this.createFromDepthAndReserve(e,t,o,u)}},{key:"createFromRangeAndReserve",value:function(e,t,a,n){if(t===1/0){var r=m(1,-e*a,-e*a*n)[0];return this.createFromReserve(a,n,0,r)}var i=Math.sqrt(e*t),c=m(i-t,a*i+n,a*n)[1],l=i*c;return this.createFromReserve(a,n,c,l)}},{key:"createFromReserve",value:function(t,a,n,r){var i=t+n,c=a+r,l=i*c,s=(Math.pow(i,2),new e);return s.realBase=t,s.realQuote=a,s.virtualBase=n,s.virtualQuote=r,s.k=l,s}},{key:"getK",value:function(e,t){return 4*Math.pow(e,3)*Math.pow(t,2)}}]),e}(),w=a(235),B=a(7),P=b.a.Text,S=d.a.TabPane,D=O.a.Option,Q=[.01,.1,1,10,100,1e3];function C(e){return Object(B.jsx)(f.a,Object(j.a)(Object(j.a)({},e),{},{min:0,formatter:function(e){var t=e.indexOf(".");return t>-1?e.length<t+3?e:parseFloat(e).toPrecision(t+3):e}}))}var F={select:{width:90},header:{display:"flex",width:"100%",height:48,marginTop:0,backgroundColor:"white",justifyContent:"space-between",alignItems:"center"},check:{marginTop:10},buyPanel:{display:"flex",flex:1,backgroundColor:"white",flexDirection:"column",marginTop:10},sellPanel:{display:"flex",flex:1,flexDirection:"column",marginTop:10},divider:{marginRight:30,width:1,height:140,backgroundColor:"#f0f0f0"},buyAndSell:{display:"flex",flex:1,flexDirection:"row",alignItems:"flex-start",justifyContent:"center"},line:{flex:1,height:1,backgroundColor:"#f0f0f0",marginTop:20},paramPanel:{position:"relative",flex:8,flexDirection:"column",justifyContent:"flex-start",minHeight:"100vh",padding:20,paddingTop:0},row:{display:"flex",flex:1,flexDirection:"row",alignItems:"center",marginTop:25},label:{width:70},input:{width:150,marginLeft:20,marginRight:20},orderBook:{display:"flex",flex:5,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",minHeight:"100vh",backgroundColor:"white",padding:10,paddingTop:0},table:{width:"100%",flex:1},tableContainer:{width:"100%",minHeight:400,maxHeight:400,backgroundColor:"pink"},title:{fontSize:18},button:{width:"50%"},tableDivider:{height:2,marginBottom:5,width:"95%",backgroundColor:"#2593fc"}},A=function(e){var t=Object(n.useState)(0),a=Object(h.a)(t,2),r=(a[0],a[1],Object(n.useState)(k.createFromDepthAndRange(8.394814025505184,3445.4497187900683))),i=Object(h.a)(r,2),c=i[0],l=i[1],b=Object(w.a)(),f=b.t,y=b.i18n,x=Object(n.useState)(c.price),m=Object(h.a)(x,2),A=m[0],R=m[1],T=Object(n.useState)(c.depth),z=Object(h.a)(T,2),M=z[0],U=z[1],H=Object(n.useState)(c.lowPrice),E=Object(h.a)(H,2),I=E[0],L=E[1],q=Object(n.useState)(c.highPrice),W=Object(h.a)(q,2),J=W[0],K=W[1],N=Object(n.useState)(c.realBase),V=Object(h.a)(N,2),Y=V[0],G=V[1],X=Object(n.useState)(c.realQuote),Z=Object(h.a)(X,2),$=Z[0],_=Z[1],ee=Object(n.useState)(Q[2]),te=Object(h.a)(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)(!0),ie=Object(h.a)(re,2),ce=ie[0],le=ie[1],se=Object(n.useState)(0),oe=Object(h.a)(se,2),ue=oe[0],he=oe[1],je=Object(n.useState)(0),be=Object(h.a)(je,2),de=be[0],Oe=be[1],fe=Object(n.useState)(0),ge=Object(h.a)(fe,2),pe=ge[0],ve=ge[1],ye=Object(n.useState)(0),xe=Object(h.a)(ye,2),me=xe[0],ke=xe[1],we=Object(n.useState)(0),Be=Object(h.a)(we,2),Pe=Be[0],Se=Be[1],De=Object(n.useState)([]),Qe=Object(h.a)(De,2),Ce=Qe[0],Fe=Qe[1],Ae=Object(n.useState)([]),Re=Object(h.a)(Ae,2),Te=Re[0],ze=Re[1],Me=Object(n.useState)(!1),Ue=Object(h.a)(Me,2),He=Ue[0],Ee=Ue[1],Ie=Object(n.useState)(!1),Le=Object(h.a)(Ie,2),qe=Le[0],We=Le[1],Je=Object(n.useState)(!1),Ke=Object(h.a)(Je,2),Ne=Ke[0],Ve=Ke[1],Ye=Object(n.useState)(!1),Ge=Object(h.a)(Ye,2),Xe=Ge[0],Ze=Ge[1],$e=Object(n.useState)(!1),_e=Object(h.a)($e,2),et=_e[0],tt=_e[1],at=Object(n.useState)(!1),nt=Object(h.a)(at,2),rt=nt[0],it=nt[1],ct=Object(n.useRef)(!0);Object(n.useEffect)((function(){if(ct.current)ct.current=!1;else if(ce){console.log(I,J,Y,$);var e=k.createFromRangeAndReserve(I,J,Y,$);l(e),R(e.price),U(e.depth),console.log(e.price,e.depth)}}),[I,J,Y,$]),Object(n.useEffect)((function(){console.log("update order book"),lt(c)}),[c]);var lt=function(e,t){var a=e.toOrders(t||ae,7);Fe(Object(u.a)(a.buy)),ze(Object(u.a)(a.sell))},st=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ne(t),lt(c,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ot=function(e){R(e);var t=k.createFromDepthAndRange(M,e);l(t),L(t.lowPrice),K(t.highPrice),G(t.realBase),_(t.realQuote)},ut=function(e){U(e);var t=k.createFromDepthAndRange(e,A);l(t),L(t.lowPrice),K(t.highPrice),G(t.realBase),_(t.realQuote)},ht=function(e){tt(e.target.checked)},jt=function(e){it(e.target.checked)},bt=function(e){L(e),console.log("price changed",e);var t=k.createFromDepthAndRange(M,A,e,J);l(t),G(t.realBase),_(t.realQuote)},dt=function(e){K(e);var t=k.createFromDepthAndRange(M,A,I,e);l(t),G(t.realBase),_(t.realQuote)},Ot=function(e){G(e);var t=k.createFromDepthAndReserve(M,A,e,$);l(t),L(t.lowPrice),K(t.highPrice)},ft=function(e){_(e);var t=k.createFromDepthAndReserve(M,A,Y,e);l(t),L(t.lowPrice),K(t.highPrice)},gt=function(e){var t=e.toString(),a=t.indexOf(".");return a>-1?parseFloat(t).toPrecision(a+3):t};return Object(B.jsxs)("div",{className:"App",children:[Object(B.jsxs)("div",{style:F.paramPanel,children:[Object(B.jsxs)(d.a,{defaultActiveKey:"0",onChange:function(e){le("0"===e)},children:[Object(B.jsx)(S,{tab:f("setPrice"),children:Object(B.jsxs)("div",{children:[Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("price")}),Object(B.jsx)(C,{style:F.input,min:0,value:A,onChange:ot}),Object(B.jsx)(P,{children:"USD"})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("depth")}),Object(B.jsx)(C,{style:F.input,min:0,value:M,onChange:ut}),Object(B.jsx)(P,{children:"ETH/USD"})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("minPrice")}),Object(B.jsx)(C,{readOnly:!et,style:Object(j.a)({},F.input),min:0,value:I,onChange:bt,onBlur:function(){I>=A&&bt(A)}}),Object(B.jsx)(P,{children:"USD"}),Object(B.jsx)(P,{style:Object(j.a)(Object(j.a)({},F.label),{},{marginLeft:60}),children:f("maxPrice")}),Object(B.jsx)(C,{readOnly:!et,style:Object(j.a)({},F.input),min:1,value:J,onChange:dt,onBlur:function(){J<=A&&dt(A)}}),Object(B.jsx)(P,{children:"USD"})]}),Object(B.jsx)(g.a,{disabled:rt,style:F.check,onChange:ht,children:f("customizePriceRange")}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("tokenAmount")}),Object(B.jsx)(C,{readOnly:!rt,style:Object(j.a)({},F.input),value:Y,onChange:Ot}),Object(B.jsx)(P,{style:F.label,children:"ETH"}),Object(B.jsx)(C,{readOnly:!rt,style:Object(j.a)(Object(j.a)({},F.input),{},{marginLeft:110}),min:0,value:$,onChange:ft}),Object(B.jsx)(P,{children:"USD"})]}),Object(B.jsx)(g.a,{disabled:et,style:F.check,onChange:jt,children:f("customizeTokenAmount")})]})},"1"),Object(B.jsx)(S,{tab:f("autoComputePrice"),children:Object(B.jsxs)("div",{children:[Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("price")}),Object(B.jsx)(C,{style:F.input,readOnly:!0,min:0,value:A,onChange:R}),Object(B.jsx)(P,{children:"USD"})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("depth")}),Object(B.jsx)(C,{style:F.input,readOnly:!0,min:0,value:M,onChange:U}),Object(B.jsx)(P,{children:"ETH/USD"})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("minPrice")}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),min:0,value:I,onChange:L}),Object(B.jsx)(P,{children:"USD"}),Object(B.jsx)(P,{style:Object(j.a)(Object(j.a)({},F.label),{},{marginLeft:60}),children:f("maxPrice")}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),min:1,value:J,onChange:K}),Object(B.jsx)(P,{children:"USD"})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:f("tokenAmount")}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),min:0,value:Y,onChange:G}),Object(B.jsx)(P,{style:F.label,children:"ETH"}),Object(B.jsx)(C,{style:Object(j.a)(Object(j.a)({},F.input),{},{marginLeft:110}),value:$,onChange:_}),Object(B.jsx)(P,{children:"USD"})]})]})},"0")]}),Object(B.jsx)("div",{style:F.line}),Object(B.jsxs)("div",{style:F.buyAndSell,children:[Object(B.jsxs)("div",{style:F.buyPanel,children:[Object(B.jsx)(v.a,{style:F.button,type:"primary",onClick:function(){if(console.log("buy"),Ee(!1),We(!1),He){c.buyBase(ue,!1),he(0),Oe(0),ve(0);var e=c.toOrders(ae,7);Fe(Object(u.a)(e.buy)),ze(Object(u.a)(e.sell)),console.log(e)}else if(qe){c.buyWithQuote(de,!1),he(0),Oe(0),ve(0);var t=c.toOrders(ae,7);Fe(Object(u.a)(t.buy)),ze(Object(u.a)(t.sell)),console.log(t)}},children:"BUY   ETH"}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:"ETH"}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),value:ue,onChange:function(e){he(e);var t=c.buyBase(e,!0);Oe(t),ve(e>0?t/e:0),Ee(!0),We(!1)}})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:"USD"}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),value:de,onChange:function(e){Oe(e);var t=c.buyWithQuote(e,!0);he(t),ve(e>0?e/t:0),Ee(!1),We(!0)}})]})]}),Object(B.jsx)("div",{style:F.divider}),Object(B.jsxs)("div",{style:F.sellPanel,children:[Object(B.jsx)(v.a,{style:F.button,type:"primary",onClick:function(){if(console.log("sell"),Ve(!1),Ze(!1),Ne){c.sellBase(me,!1),ke(0),Se(0),ve(0);var e=c.toOrders(ae,7);ze(Object(u.a)(e.sell)),Fe(Object(u.a)(e.buy)),console.log(e)}else if(Xe){c.sellWithQuote(Pe,!1),ke(0),Se(0),ve(0);var t=c.toOrders(ae,7);ze(Object(u.a)(t.sell)),Fe(Object(u.a)(t.buy)),console.log(t)}},children:"SELL   ETH"}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:"ETH"}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),value:me,onChange:function(e){ke(e);var t=c.sellBase(e,!0);Se(t),ve(e>0?t/e:0),Ve(!0),Ze(!1)}})]}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:"USD"}),Object(B.jsx)(C,{style:Object(j.a)({},F.input),value:Pe,onChange:function(e){Se(e);var t=c.sellForQuote(e,!0);ke(t),ve(e>0?e/t:0),Ve(!1),Ze(!0)}})]})]})]}),Object(B.jsx)("div",{style:F.line}),Object(B.jsxs)("div",{style:F.row,children:[Object(B.jsx)(P,{style:F.label,children:"Avg Price"}),Object(B.jsx)(C,{readOnly:!0,value:pe,style:Object(j.a)({},F.input)})]}),Object(B.jsx)(v.a,{style:{position:"absolute",top:10,right:10},type:"link",onClick:function(){y.changeLanguage("zh"===y.language?"en":"zh")},children:"zh"===y.language?"en":"zh"})]}),function(){var e=[{title:"Price(USDT)",dataIndex:"price",key:"price",render:function(e,t,a){return parseFloat(e)>0?e:Object(B.jsx)(P,{style:{color:"white"},children:"0"})}},{title:"Amount(ETH)",dataIndex:"amount",key:"amount",render:function(e,t,a){return parseFloat(e)>0?e:Object(B.jsx)(P,{style:{color:"white"},children:"0"})}},{title:"Total(USDT)",dataIndex:"total",key:"total",render:function(e,t,a){return parseFloat(e)>0?e:Object(B.jsx)(P,{style:{color:"white"},children:"0"})}}],t=Te.sort((function(e,t){return t.price-e.price})).map((function(e){return{price:gt(e.price),amount:gt(e.amount),total:gt(e.price*e.amount)}}));if(t.length<7)for(var a=t.length,n=0;n<7-a;n++)t.unshift({price:"-1",amount:"-1",total:"-1"});var r=Ce.sort((function(e,t){return t.price-e.price})).map((function(e){return{price:gt(e.price),amount:gt(e.amount),total:gt(e.price*e.amount)}}));if(r.length<7)for(var i=r.length,c=0;c<7-i;c++)r.push({price:"-1",amount:"-1",total:"-1"});return Object(B.jsxs)("div",{style:F.orderBook,children:[Object(B.jsxs)("div",{style:F.header,children:[Object(B.jsx)(P,{style:F.title,strong:!0,children:"Order book"}),Object(B.jsx)(O.a,{defaultValue:Q[2],style:F.select,onChange:st,children:Q.map((function(e){return Object(B.jsx)(D,{value:e,children:e},e)}))})]}),Object(B.jsx)(p.a,{columns:e,scroll:{y:280},bordered:!0,size:"small",sticky:{offsetScroll:180},dataSource:t,pagination:!1,style:Object(j.a)(Object(j.a)({},F.table),{},{borderBottom:"0px solid #2593fc"})}),Object(B.jsx)(p.a,{showHeader:!1,columns:e,scroll:{y:280},bordered:!0,size:"small",dataSource:r,pagination:!1,style:Object(j.a)(Object(j.a)({},F.table),{},{borderTop:"0px solid #2593fc"})})]})}()]})},R=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,236)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;a(e),n(e),r(e),i(e),c(e)}))},T=a(107),z=a(80);T.a.use(z.e).init({debug:!0,lng:"zh",resources:{en:{translation:{setPrice:"Preset price and depth",autoComputePrice:"Preset price range and token amount",maxPrice:"max price",minPrice:"min price",tokenAmount:"amount",price:"price",depth:"depth",customizePriceRange:"customize price range",customizeTokenAmount:"customize token amount"}},zh:{translation:{setPrice:"\u6307\u5b9a\u76d8\u53e3\u4ef7\u683c\u548c\u6df1\u5ea6",autoComputePrice:"\u6307\u5b9a\u4ef7\u683c\u8303\u56f4\u548c\u8d44\u91d1\u91cf",maxPrice:"\u6700\u9ad8\u4ef7",minPrice:"\u6700\u4f4e\u4ef7",tokenAmount:"\u505a\u5e02\u8d44\u91d1\u91cf",price:"\u76d8\u53e3\u4ef7\u683c",depth:"\u76d8\u53e3\u6df1\u5ea6",customizePriceRange:"\u81ea\u5b9a\u4e49\u505a\u5e02\u4ef7\u683c\u8303\u56f4",customizeTokenAmount:"\u81ea\u5b9a\u4e49\u505a\u5e02\u8d44\u91d1\u91cf"}}},react:{wait:!1,bindI18n:"languageChanged loaded",bindStore:"added removed",nsMode:"default"}});T.a;c.a.render(Object(B.jsx)(r.a.StrictMode,{children:Object(B.jsx)(A,{})}),document.getElementById("root")),R()}},[[227,1,2]]]);
//# sourceMappingURL=main.753af9cf.chunk.js.map